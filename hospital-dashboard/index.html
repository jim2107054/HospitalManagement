<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Management Dashboard</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Session Check Script -->
    <script>
        // Check if user is logged in before loading the page
        (async function checkAuth() {
            try {
                const response = await fetch('php/auth.php?action=check_session');
                const data = await response.json();
                
                if (!data.success || !data.logged_in) {
                    // User is not logged in, redirect to login page
                    window.location.href = 'login.html';
                } else {
                    // Store user info for display
                    window.currentUser = data.user;
                    // Update user display after DOM loads
                    document.addEventListener('DOMContentLoaded', () => {
                        const userNameSpan = document.querySelector('.user-info span');
                        if (userNameSpan && window.currentUser) {
                            userNameSpan.textContent = window.currentUser.full_name || window.currentUser.username;
                        }
                    });
                }
            } catch (error) {
                console.error('Session check error:', error);
                // On error, redirect to login
                window.location.href = 'login.html';
            }
        })();
    </script>
    <div class="dashboard-container">
        <!-- Left Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-hospital"></i>
                    <h2>MediPlus+</h2>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="overview">
                        <i class="fas fa-chart-pie"></i>
                        <span>Overview</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="patients">
                        <i class="fas fa-user-injured"></i>
                        <span>Patients</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="departments">
                        <i class="fas fa-building"></i>
                        <span>Departments</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="doctors">
                        <i class="fas fa-user-md"></i>
                        <span>Doctors</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="appointments">
                        <i class="fas fa-calendar-check"></i>
                        <span>Appointments</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="medical-reports">
                        <i class="fas fa-file-medical"></i>
                        <span>Medical Reports</span>
                    </a>
                </li>
            </ul>
            
            <!-- Logout Button at Bottom -->
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="page-title">Overview</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span>Admin User</span>
                    </div>
                </div>
            </header>

            <div class="content-area" id="content-area">
                <!-- Dynamic content will be loaded here -->
                
                <!-- Overview Page (Default) -->
                <div id="overview-page" class="page-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-injured"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-patients">0</h3>
                                <p>Total Patients</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-doctors">0</h3>
                                <p>Total Doctors</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-appointments">0</h3>
                                <p>Total Appointments</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-departments">0</h3>
                                <p>Total Departments</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="today-appointments">0</h3>
                                <p>Today's Appointments</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="week-patients">0</h3>
                                <p>New Patients (This Week)</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="upcoming-appointments">0</h3>
                                <p>Upcoming Appointments</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="avg-consultation-fee">$0.00</h3>
                                <p>Avg Consultation Fee</p>
                            </div>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>Appointments by Status</h3>
                            <canvas id="appointmentStatusChart"></canvas>
                        </div>
                        
                        <div class="chart-card">
                            <h3>Patients by Blood Group</h3>
                            <canvas id="bloodGroupChart"></canvas>
                        </div>
                        
                        <div class="chart-card">
                            <h3>Doctors by Department</h3>
                            <canvas id="departmentChart"></canvas>
                        </div>

                        <div class="chart-card">
                            <h3>Patients by Gender</h3>
                            <canvas id="genderChart"></canvas>
                        </div>

                        <div class="chart-card">
                            <h3>Patients by Age Group</h3>
                            <canvas id="ageGroupChart"></canvas>
                        </div>

                        <div class="chart-card">
                            <h3>Department Revenue (30 days)</h3>
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Patients Page -->
                <div id="patients-page" class="page-content">
                    <div class="page-header">
                        <h2>Patients Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="openCrudModal('patients', 'create')">
                                <i class="fas fa-plus"></i> Add Patient
                            </button>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-item">
                            <h3 id="patients-total">0</h3>
                            <p>Total Patients</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="patients-male">0</h3>
                            <p>Male</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="patients-female">0</h3>
                            <p>Female</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="patients-today">0</h3>
                            <p>Registered Today</p>
                        </div>
                    </div>
                    
                    <!-- TEMPORARY TEST BUTTON - FOR DEBUGGING -->
                    <div style="margin: 20px 0; padding: 15px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
                        <strong>🧪 DEBUG TEST:</strong>
                        <button onclick="testSQLDisplay()" style="background: #ff6b6b; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                            Test SQL Display (Click Me!)
                        </button>
                        <button onclick="checkSQLStorage()" style="background: #4dabf7; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                            Check SQL Storage
                        </button>
                    </div>

                    <div class="filters-section">
                        <h3>Filter & Sort Patients</h3>
                        <form id="patients-filter-form" method="GET">
                            <div class="filters-grid">
                                <!-- <select id="filter-patient-name" name="name" class="filter-select">
                                    <option value="">All Names</option>
                                </select> -->
                                
                                <select id="filter-patient-gender" name="gender" class="filter-select">
                                    <option value="">Genders</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                                
                                <select id="filter-patient-blood-group" name="blood_group" class="filter-select">
                                    <option value="">Blood Groups</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                                
                                <!-- <select id="filter-patient-phone" name="phone" class="filter-select">
                                    <option value="">All Phone Numbers</option>
                                    
                                </select> -->
                                
                                <!-- <select id="filter-patient-email" name="email" class="filter-select">
                                    <option value="">All Emails</option>
                                    
                                </select>
                                
                                <select id="filter-patient-birth-year" name="birth_year" class="filter-select">
                                    <option value="">All Birth Years</option>
                                    
                                </select>
                                
                                <select id="filter-patient-registered-date" name="registered_date" class="filter-select">
                                    <option value="">All Registration Dates</option>
                                    
                                </select> -->
                                
                                <select id="sort-patient-by" name="sort_by" class="filter-select">
                                    <option value="name">Sort by Name</option>
                                    <option value="date_of_birth">Sort by Birth Date</option>
                                    <option value="gender">Sort by Gender</option>
                                    <option value="blood_group">Sort by Blood Group</option>
                                    <option value="registered_at">Sort by Registration Date</option>
                                </select>
                                
                                <select id="sort-patient-order" name="sort_order" class="filter-select">
                                    <option value="ASC">Ascending</option>
                                    <option value="DESC">Descending</option>
                                </select>
                                
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                                <button type="button" class="btn btn-outline" onclick="dashboard.clearFilters('patients')">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                                <button type="button" class="btn btn-icon sql-code-btn" onclick="showSQLCode('patients')" title="View SQL Code">
                                    <i class="fas fa-code"></i>
                                </button>
                            </div>
                        </form>
                        <div class="sql-display" id="patients-sql-display" style="display: none;">
                            <button class="btn btn-icon sql-toggle-btn" onclick="toggleSQLDisplay('patients')" title="View SQL Code">
                                <i class="fas fa-code"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table" id="patients-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Date of Birth</th>
                                    <th>Gender</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Blood Group</th>
                                    <th>Registered</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="patients-table-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Departments Page -->
                <div id="departments-page" class="page-content">
                    <div class="page-header">
                        <h2>Departments Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="dashboard.openCrudModal('departments', 'create')">
                                <i class="fas fa-plus"></i> Add Department
                            </button>
                            <button class="btn btn-outline" onclick="exportData('departments')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-item">
                            <h3 id="departments-total">0</h3>
                            <p>Total Departments</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="departments-with-head">0</h3>
                            <p>With Head Doctor</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="departments-doctors">0</h3>
                            <p>Total Doctors</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="departments-active">0</h3>
                            <p>Active Departments</p>
                        </div>
                    </div>

                    <div class="filters-section">
                        <h3>Filter Departments</h3>
                        <div class="filters-grid">
                            <select id="filter-dept-name" class="filter-select">
                                <option value="">Department Names</option>
                                <!-- Options will be loaded dynamically -->
                            </select>                  
                            <select id="filter-dept-location" class="filter-select">
                                <option value="">Locations</option>
                                <!-- Options will be loaded dynamically -->
                            </select>
                            <select id="filter-dept-contact" class="filter-select">
                                <option value="">Contact Numbers</option>
                                <!-- Options will be loaded dynamically -->
                            </select>
                            <select id="filter-dept-head-doctor" class="filter-select">
                                <option value="">Head Doctors</option>
                                <!-- Options will be loaded dynamically -->
                            </select>
                            <select id="filter-dept-created-date" class="filter-select">
                                <option value="">Created Dates</option>
                                <!-- Options will be loaded dynamically -->
                            </select>
                            <button class="btn btn-secondary" onclick="applyFilters('departments')">
                                <i class="fas fa-filter"></i> Apply Filters
                            </button>
                            <button class="btn btn-outline" onclick="clearFilters('departments')">
                                <i class="fas fa-times"></i> Clear
                            </button>
                            <button class="btn btn-icon sql-code-btn" onclick="showSQLCode('departments')" title="View SQL Code">
                                <i class="fas fa-code"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table" id="departments-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Head Doctor</th>
                                    <th>Contact</th>
                                    <th>Location</th>
                                    <th>Doctors Count</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="departments-table-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Doctors Page -->
                <div id="doctors-page" class="page-content">
                    <div class="page-header">
                        <h2>Doctors Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="openCrudModal('doctors', 'create')">
                                <i class="fas fa-plus"></i> Add Doctor
                            </button>
                            <button class="btn btn-outline" onclick="exportData('doctors')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-item">
                            <h3 id="doctors-total">0</h3>
                            <p>Total Doctors</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="doctors-available">0</h3>
                            <p>Available Today</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="doctors-specializations">0</h3>
                            <p>Specializations</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="doctors-appointments-today">0</h3>
                            <p>Appointments Today</p>
                        </div>
                    </div>

                    <div class="filters-section">
                        <h3>Filter & Sort Doctors</h3>
                        <form id="doctors-filter-form" onsubmit="event.preventDefault(); applyFilters('doctors'); return false;">
                            <div class="filters-grid">
                                <select id="filter-doctor-name" name="name" class="filter-select">
                                    <option value="">Doctor Names</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <select id="filter-doctor-specialization" name="specialization" class="filter-select">
                                    <option value="">Specializations</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <!-- <select id="filter-doctor-department" name="department_name" class="filter-select">
                                    <option value="">All Departments</option>
                                    
                                </select> -->
                                
                                <select id="filter-doctor-experience" name="experience_range" class="filter-select">
                                    <option value="">Experience Levels</option>
                                    <option value="0-5">0-5 years</option>
                                    <option value="5-10">5-10 years</option>
                                    <option value="10-15">10-15 years</option>
                                    <option value="15+">15+ years</option>
                                </select>
                                
                                <select id="filter-doctor-fee-range" name="fee_range" class="filter-select">
                                    <option value="">Consultation Fees</option>
                                    <option value="0-50">Under $50</option>
                                    <option value="50-100">$50 - $100</option>
                                    <option value="100-150">$100 - $150</option>
                                    <option value="150+">Over $150</option>
                                </select>
                                
                                <select id="sort-doctor-by" name="sort_by" class="filter-select">
                                    <option value="name">Sort by Name</option>
                                    <option value="specialization">Sort by Specialization</option>
                                    <option value="department_name">Sort by Department</option>
                                    <option value="experience_years">Sort by Experience</option>
                                    <option value="consultation_fee">Sort by Fee</option>
                                </select>
                                
                                <select id="sort-doctor-order" name="sort_order" class="filter-select">
                                    <option value="ASC">Ascending</option>
                                    <option value="DESC">Descending</option>
                                </select>
                                
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                                <button type="button" class="btn btn-outline" onclick="dashboard.clearFilters('doctors')">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                                <button type="button" class="btn btn-icon sql-code-btn" onclick="showSQLCode('doctors')" title="View SQL Code">
                                    <i class="fas fa-code"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="table-container">
                        <table class="data-table" id="doctors-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Specialization</th>
                                    <th>Department</th>
                                    <th>Phone</th>
                                    <th>Email</th>
                                    <th>Experience</th>
                                    <th>Fee</th>
                                    <th>Availability</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="doctors-table-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Appointments Page -->
                <div id="appointments-page" class="page-content">
                    <div class="page-header">
                        <h2>Appointments Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="openCrudModal('appointments', 'create')">
                                <i class="fas fa-plus"></i> Add Appointment
                            </button>
                            <button class="btn btn-outline" onclick="exportData('appointments')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-item">
                            <h3 id="appointments-total">0</h3>
                            <p>Total Appointments</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="appointments-today">0</h3>
                            <p>Today's Appointments</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="appointments-scheduled">0</h3>
                            <p>Scheduled</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="appointments-completed">0</h3>
                            <p>Completed</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="appointments-upcoming">0</h3>
                            <p>This Week</p>
                        </div>
                    </div>

                    <div class="filters-section">
                        <h3>Filter & Sort Appointments</h3>
                        <form id="appointments-filter-form" onsubmit="event.preventDefault(); applyFilters('appointments'); return false;">
                            <div class="filters-grid">
                                <select id="filter-appointment-patient" name="patient_name" class="filter-select">
                                    <option value="">Patients</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <select id="filter-appointment-doctor" name="doctor_name" class="filter-select">
                                    <option value="">Doctors</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <select id="filter-appointment-department" name="department_name" class="filter-select">
                                    <option value="">Departments</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <input type="date" id="filter-appointment-date-from" name="date_from" class="filter-select" placeholder="From Date">
                                
                                <input type="date" id="filter-appointment-date-to" name="date_to" class="filter-select" placeholder="To Date">
                                
                                <select id="filter-appointment-status" name="status" class="filter-select">
                                    <option value="">Status</option>
                                    <option value="Scheduled">Scheduled</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                    <option value="No-Show">No-Show</option>
                                </select>
                                
                                <select id="sort-appointment-by" name="sort_by" class="filter-select">
                                    <option value="appointment_date">Sort by Date</option>
                                    <option value="patient_name">Sort by Patient</option>
                                    <option value="doctor_name">Sort by Doctor</option>
                                    <option value="status">Sort by Status</option>
                                </select>
                                
                                <select id="sort-appointment-order" name="sort_order" class="filter-select">
                                    <option value="DESC">Newest First</option>
                                    <option value="ASC">Oldest First</option>
                                </select>
                                
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                                <button type="button" class="btn btn-outline" onclick="dashboard.clearFilters('appointments')">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                                <button type="button" class="btn btn-icon sql-code-btn" onclick="showSQLCode('appointments')" title="View SQL Code">
                                    <i class="fas fa-code"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="table-container">
                        <table class="data-table" id="appointments-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Patient</th>
                                    <th>Doctor</th>
                                    <th>Department</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Reason</th>
                                    <th>Fee</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="appointments-table-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Medical Reports Page -->
                <div id="medical-reports-page" class="page-content">
                    <div class="page-header">
                        <h2>Medical Reports Management</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="openCrudModal('medical-reports', 'create')">
                                <i class="fas fa-plus"></i> Add Medical Report
                            </button>
                            <button class="btn btn-outline" onclick="exportData('medical-reports')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-item">
                            <h3 id="reports-total">0</h3>
                            <p>Total Reports</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="reports-today">0</h3>
                            <p>Today's Reports</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="reports-this-week">0</h3>
                            <p>This Week</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="reports-follow-ups">0</h3>
                            <p>Follow-ups Due</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="reports-unique-patients">0</h3>
                            <p>Unique Patients</p>
                        </div>
                    </div>

                    <div class="filters-section">
                        <h3>Filter & Sort Medical Reports</h3>
                        <form id="medical-reports-filter-form" onsubmit="event.preventDefault(); applyFilters('medical-reports'); return false;">
                            <div class="filters-grid">
                                <select id="filter-report-patient" name="patient_name" class="filter-select">
                                    <option value="">Patients</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <select id="filter-report-doctor" name="doctor_name" class="filter-select">
                                    <option value="">Doctors</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <select id="filter-report-department" name="department_name" class="filter-select">
                                    <option value="">Departments</option>
                                    <!-- Options will be loaded dynamically -->
                                </select>
                                
                                <input type="date" id="filter-report-date-from" name="date_from" class="filter-select" placeholder="From Date">
                                
                                <input type="date" id="filter-report-date-to" name="date_to" class="filter-select" placeholder="To Date">
                                
                                <select id="filter-report-follow-up" name="follow_up_status" class="filter-select">
                                    <option value="">All Follow-up Status</option>
                                    <option value="with_followup">With Follow-up</option>
                                    <option value="without_followup">Without Follow-up</option>
                                    <option value="followup_due">Follow-up Due</option>
                                    <option value="followup_overdue">Follow-up Overdue</option>
                                </select>
                                
                                <select id="sort-report-by" name="sort_by" class="filter-select">
                                    <option value="visit_date">Sort by Visit Date</option>
                                    <option value="patient_name">Sort by Patient</option>
                                    <option value="doctor_name">Sort by Doctor</option>
                                    <option value="follow_up_date">Sort by Follow-up Date</option>
                                </select>
                                
                                <select id="sort-report-order" name="sort_order" class="filter-select">
                                    <option value="DESC">Newest First</option>
                                    <option value="ASC">Oldest First</option>
                                </select>
                                
                                <button type="submit" class="btn btn-secondary">
                                    <i class="fas fa-filter"></i> Apply Filters
                                </button>
                                <button type="button" class="btn btn-outline" onclick="dashboard.clearFilters('medical-reports')">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                                <button type="button" class="btn btn-icon sql-code-btn" onclick="showSQLCode('medical-reports')" title="View SQL Code">
                                    <i class="fas fa-code"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="table-container">
                        <table class="data-table" id="medical-reports-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Patient</th>
                                    <th>Doctor</th>
                                    <th>Department</th>
                                    <th>Visit Date</th>
                                    <th>Diagnosis</th>
                                    <th>Treatment</th>
                                    <th>Follow-up</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="medical-reports-table-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- CRUD Modal -->
    <div id="crud-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Item</h3>
                <span class="close-modal" onclick="closeCrudModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Form will be dynamically generated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCrudModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitCrudForm()">Save</button>
            </div>
        </div>
    </div>

    <!-- SQL Code Display Modal -->
    <div id="sql-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Applied SQL Query</h3>
                <span class="close-modal" onclick="closeSQLModal()">&times;</span>
            </div>
            <div class="modal-body">
                <pre id="sql-code-display"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSQLModal()">Close</button>
                <button class="btn btn-primary" onclick="copySQLCode()">Copy Code</button>
            </div>
        </div>
    </div>

    <!-- SQL Code Display Popup -->
    <div id="sql-popup" class="modal-overlay" style="display: none;">
        <div class="modal-content sql-modal">
            <div class="modal-header">
                <h3>SQL Query</h3>
                <button class="modal-close" onclick="closeSQLPopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="sql-description">SQL query used for current filter:</p>
                <div class="sql-code-container">
                    <pre id="sql-popup-code-display">No query available</pre>
                </div>
                <div class="sql-actions">
                    <button class="btn btn-secondary" onclick="copySQLCode()">
                        <i class="fas fa-copy"></i> Copy SQL
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Scripts in correct loading order -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="js/charts.js"></script>
    <script src="js/crud.js"></script>
    <script src="js/main.js"></script>
    
    <!-- SQL Popup click-outside handler -->
    <script>
        document.addEventListener('click', function(event) {
            const sqlPopup = document.getElementById('sql-popup');
            if (event.target === sqlPopup) {
                closeSQLPopup();
            }
        });
        
        // TEMPORARY TEST FUNCTIONS - FOR DEBUGGING
        function testSQLDisplay() {
            console.log('🧪 TEST: Manual SQL display test');
            
            // Manually set SQL in the dashboard object
            const testSQL = 'SELECT * FROM patients WHERE gender = ? ORDER BY name ASC -- Parameters: ["Male"]';
            
            if (window.dashboard) {
                window.dashboard.lastSQLQueries['patients'] = testSQL;
                console.log('✓ Manually set SQL for patients:', testSQL);
                console.log('✓ lastSQLQueries object:', window.dashboard.lastSQLQueries);
                
                // Now show it
                window.dashboard.showSQLCode('patients');
            } else {
                alert('ERROR: Dashboard not available!');
                console.error('window.dashboard is not defined');
            }
        }
        
        function checkSQLStorage() {
            console.log('🔍 CHECKING SQL STORAGE:');
            
            if (window.dashboard) {
                console.log('✓ Dashboard exists');
                console.log('lastSQLQueries:', window.dashboard.lastSQLQueries);
                console.log('Current page:', window.dashboard.currentPage);
                
                const sql = window.dashboard.lastSQLQueries['patients'];
                if (sql && sql.trim() !== '') {
                    alert('✓ SQL IS STORED for patients!\n\nSQL: ' + sql.substring(0, 100) + '...');
                } else {
                    alert('✗ NO SQL stored for patients\n\nGo to Patients page and apply a filter first!');
                }
            } else {
                alert('ERROR: Dashboard not initialized!');
                console.error('window.dashboard is undefined');
            }
        }
    </script>
</body>
</html>